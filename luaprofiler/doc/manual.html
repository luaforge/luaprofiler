<html><head><!-- See Copyright Notice in license.html--><title>LuaProfiler: Time profiler for the Lua programming language</title>

<style type="text/css">
ul { list-style-type: disc };
</style></head>


<body bgcolor="#ffffff">

<hr>

<center>
<table border="0" cellspacing="2" cellpadding="2">
<tbody><tr><td align="center"><a href="http://www.keplerproject.org/luaprofiler">
<img border="0" alt="LuaProfiler logo" src="imgs/luaprofiler.png"></a>
</td></tr><tr><td align="center"><big><b>LuaProfiler Reference Manual</b></big>
</td></tr><tr><td align="center" valign="top">Time profiler for the
<a href="http://www.lua.org/">Lua</a>
programming language
</td></tr></tbody></table>
</center>
<p>

</p><center><small>
<a href="http://www.keplerproject.org/luaprofiler/">home</a> ·
<a href="#introduction">Introduction</a> ·
<a href="#install">Compilation and installation</a> ·
<a href="#analyzer">The Analyzer</a>
</small></center>
<p>

</p><hr>
  <a name="introduction">
	</a><dl><dt></dt><h2><a name="introduction">Introduction</a></h2><dd>
<p>	<ul><i>More computing sins are committed in the name of efficiency (without <br>
	necessarily achieving it) than for any other single reason - including <br>
	blind stupidity. <br>
	- W.A. Wulf </i></ul>
</p>
<p>    There are several reasons to not optimize your program prematurely. Some 
    of them include unnecessary loss of time, maintainability and robustness. 
</p>
<p>    A profiler tells you what parts of your program are slow, so you can 
    focus on them and forget about the rest. The slow parts are called 
    bottlenecks. A bottleneck is a part of your program that is much slower than 
    the rest of the program. 
</p>
<p>    If you are programming in Lua, as a rule of thumb once you found a 
    bottleneck you have two options: fine tune your code, possibly rewriting 
    some functions in C or, arguably the better option, redesigning your code. </p>
<p>    To fine tune your Lua code, all you need to know is how slow the functions
    are. Then you can rewrite some of them, possibly in C. This option not
    necessarily improves significantly your performance. 
</p>
<p>    To redesign your Lua code, you need more than that: you'll need to know 
    how slow the functions are and which context makes them slow. A general
    solution aims to avoid unnecessary calls and loops.</p>
<p>    When you do that, you reduce the complexity of your code, which can give 
    you much more significant speed improvements in some situations. If you 
    still need to speed things up and redesigning is not a viable option 
    anymore, go ahead and fine tune the slower functions. </p>
<p>    To fine tune, you need only timing numbers, but to redesign you need
    a better view of your program. This profiler helps you in these two 
    processes. 
</p>
<p>    For flexibility reasons, it is divided in 2 parts: the Lua code profiler, 
    written in C to maximize the precision of timing, and the analyzer, written 
    in Lua, that generates information about the program execution. This information
    can be used to generate the usage graph of the profiled program.
</p>
<p>    The code profiler produces as result a table of function calls and times 
    that is usable by the analyzer itself or by a spreadsheet, so you can 
    analyze the results numerically to help you to fine tune your program. </p>
<p>    If you want to use the analyzer to generate your usage graph, you'll need 
    a graph viewer called aiSee as documented below.</p>
<p></p>
  </dd></dl>

  <a name="install">
	</a><dl><dt></dt><h2><a name="install">Compilation and installation</a></h2><dd>
<p>	luaProfiler can profile programs written in Lua 3.2, Lua 4.0, Lua 5.0 and in LuaNG
(used by older versions of CGILua).
</p>
<p>Edit the Makefile and choose your version of Lua, then type make.</p>
<p>To profile your program for versions of Lua prior to 5.0, include the "luaProfiler.h" header into your main module,
	include a call to "init_profiler(L)" after opening the Lua library and recompile it
	using the appropriate luaProfiler lib. If you are profiling Lua 3.2 programs,
	consider "L" to be NULL.</p>
<p>For Lua 5.0, the process is a bit different: we don't need to modify the executable
	file (thanks to loadlib). Just put "luaprofiler_lua50.so" on the library path and
	start Lua 5.0 with the script provided in the "bin" directory:<p>
<p><ul><pre>
#! /bin/sh
 
lua -e 'local f, e1, e2 = loadlib("./luaprofiler_lua50.so", "luaopen_profiler") assert(f, (e1 or "").."\t"..(e2 or "")) f()' $*</pre></ul></p>
<p>All you need now is to run your program and get the output generated by the
	profiler. The output file is written to the working directory of the program,
	in a file like "lprof_<id>.out".
	By now, a line is generated for every function call in your program, which may
	leed to huge files. Be careful.</p>
  </dd></dl>

    <a name="analyzer">
		</a><dl><dt></dt><h3><a name="analyzer">The Analyzer</h3><dd>
<p>The analyzer needs to be interpreted by Lua 5.0.</p>
<p>You should get aiSee Visualization Tool, developed by AbsInt, to view the graphs.
	aiSee runs in several platforms, including Windows and Linux, and has a 30-day
	free trial period. If you use it for non-commercial purposes, you can register it
	for free.</p>
<p>Please, get aiSee at http://www.aisee.com</p>
<p>The analyzer will generate input files for the aiSee program.
	Assuming the lua 5.0 interpreter is in the path, switch to the
	analyzer directory and type:</p>
<p><ul><pre>lua profile_data="<file>" gdl_output="<file>" Analyze.lua</pre></ul></p>
<p><i>(the "gdl_output" is the input to the aiSee program)</i></p>
<p>Now run the aiSee program passing the gdl file as the argument and you will
	see the graph. Enjoy.</p>
  </dd></dl>

<p>
</p><center><small>
<a href="http://www.keplerproject.org/luaprofiler/">home</a> ·
<a href="#introduction">Introduction</a> ·
<a href="#install">Compilation and installation</a> ·
<a href="#analyzer">The Analyzer</a>
</small></center>
<p>

</p><hr>
</body></html>
